# Интерактивный дашборд для анализа погодных данных

## Описание

Данный проект представляет собой интерактивное веб-приложение для анализа и визуализации погодных данных, созданное на основе датасета [Global Daily Climate Data](https://www.kaggle.com/datasets/guillemservera/global-daily-climate-data) с Kaggle. Реализовано с использованием Streamlit и включает два дашборда: "Основной дашборд" и "Дополнительные метрики", каждый из которых предоставляет аналитические метрики, визуализации и возможность экспорта данных. Приложение соответствует всем требованиям, обеспечивая удобный интерфейс и интерактивность.

**Основные возможности**:
- Фильтры по странам, городам, сезонам и временным диапазонам.
- Метрики: средние значения, медианы, корреляции, сезонные агрегации.
- Визуализации: линейные графики, диаграммы рассеяния, гистограммы, географическая карта.
- Экспорт данных в формате `.xlsx`.
- Интуитивный интерфейс с боковой панелью и реактивными компонентами.

## Архитектура

Проект использует упрощённую чистую архитектуру, адаптированную под Streamlit и небольшой масштаб приложения. Логика разделена на слои для изоляции ответственности:

- **Презентационный слой (`src/views/`)**: Управляет интерфейсом.
  - `main_dashboard.py`: Основной дашборд с метриками, графиками и таблицей.
  - `additional_dashboard.py`: Дополнительные метрики, сезонная статистика и карта.
  - `sidebar.py`: Фильтры в боковой панели.
  - Разделение изолирует логику представления, упрощая поддержку.
- **Сервисный слой (`src/services/metrics_calculator.py`)**: Функции расчёта метрик (например, средняя температура, корреляция). Вычисления отделены от UI для переиспользования.
- **Репозиторий (`src/repository.py`)**: Доступ к данным через SQLAlchemy с кэшированием (`@st.cache_data`), минимизируя обращения к базе.
- **Утилиты (`src/utils/`)**:
  - `column_names.py`: Словари переводов и функции переименования столбцов.
  - `constants.py`: Глобальные константы (например, лимиты записей).
  - `logging_config.py`: Настройка логирования.
- **Загрузка данных (`src/data_loaders.py`)**: Создаёт SQLite базу данных из CSV и Parquet файлов, нормализует даты и добавляет индексы на `date`, `city_name`, `season` для оптимизации запросов.

Такое разделение позволяет чётко разграничить работу с данными, бизнес-логику и интерфейс, что соответствует принципам чистой архитектуры, но адаптировано под ограничения Streamlit (например, отсутствие сложной маршрутизации).<p>
SQLite выбрана для хранения данных, а индексы обеспечивают быстрый доступ даже при большом объёме (27,6 млн записей). Архитектура упрощает расширение, например, добавление новых метрик.

## Установка и запуск

### Требования

- **Python 3.13** (рекомендуется).
- **Make**: Для выполнения команд `make`.
- **Docker** и **Docker Compose**: Для запуска в контейнере.
- **curl**: Для загрузки данных с Kaggle.
- **Зависимости Python** (`requirements.txt`):
  - `streamlit==1.45.1`
  - `pandas==2.2.3`
  - `sqlalchemy==2.0.41`
  - `plotly==5.22.0`
  - `openpyxl==3.1.2`

### Способы получения проекта

1. **Через ZIP-архив** (рекомендуемый способ, т.к. быстрее):
   - Содержит код, датасеты (`data/countries.csv`, `data/cities.csv`, `data/daily_weather.parquet`) и базу данных (`data/db.sqlite`).
   - Скачайте архив с [Google Drive](https://drive.google.com/file/d/1wneA1Z0q0IEXsUvkI57C2mRNSG2juqoW/view?usp=sharing) и распакуйте.
2. **Через GitHub**:
   ```bash
   git clone https://github.com/NikkZav/sber_test-task.git
   cd sber_test-task
   ```
   > [!IMPORTANT]
   > Данные отсутствуют, их нужно загрузить (см. сценарии).

### Сценарии запуска

#### 1. Локальный запуск с данными (`make local-run-with-data`)
- **Когда**: ZIP-архив с данными.
- **Шаги**:
  ```bash
  make local-run-with-data
  ```
  Это устанавливает зависимости и запускает приложение.
- **Результат**: Откройте `http://localhost:8501`.
- **Примечание**: Самый быстрый способ, так как база готова.

#### 2. Локальный запуск без данных (`make local-run-download-data`)
- **Когда**: Проект из GitHub => данных нет.
- **Шаги**:
  ```bash
  make local-run-download-data
  ```
  Это:
  1. Загружает датасет с Kaggle через `curl`.
  2. Распаковывает файлы.
  3. Создаёт базу данных (около 10 минут).
  4. Устанавливает зависимости и запускает приложение.
- **Результат**: Откройте `http://localhost:8501`.
- **Примечание**: Долгая подготовка из-за заполнения БД.

#### 3. Docker-запуск с данными и локальной сборкой (`make docker-run-with-data`)
- **Когда**: ZIP-архив с данными.
- **Шаги**:
  ```bash
  make docker-run-with-data
  ```
  Это собирает образ и запускает контейнер.
- **Результат**: Откройте `http://localhost:8501`.
- **Примечание**: Медленнее локального запуска из-за контейнеризации.

#### 4. Docker-запуск с данными и образом из Docker Hub (`make docker-run-with-hub-image`)
- **Когда**: ZIP-архив с данными, образ из Docker Hub.
- **Шаги**:
  ```bash
  make docker-run-with-hub-image
  ```
  Это скачивает образ `nikkizav/sber_test-task-app:latest` и запускает контейнер.
- **Результат**: Откройте `http://localhost:8501`.
- **Примечание**: Быстрее, чем билдить самому, но из-за контейнеризации медленнее локального запуска.

#### 5. Docker-запуск без данных и локальной сборкой (`make docker-run-download-data`)
- **Ситуация**: Проект из GitHub => данных нет.
- **Шаги**:
  ```bash
  make docker-run-download-data
  ```
  Это загружает данные, создаёт базу, собирает образ и запускает контейнер.
- **Результат**: Откройте `http://localhost:8501`.
- **Примечание**: Самый долгий вариант (от 15 минут).

#### 6. Docker-запуск без данных и образом из Docker Hub (`make docker-run-download-data-with-hub-image`)
- **Ситуация**: Проект из GitHub => данных нет, образ из Docker Hub.
- **Шаги**:
  ```bash
  make docker-run-download-data-with-hub-image
  ```
  Это загружает данные, создаёт базу, скачивает образ с Docker Hub и запускает контейнер.
- **Результат**: Откройте `http://localhost:8501`.
- **Примечание**: Быстрее, чем билдить самому, но долгая подготовка данных.

### В итоге:
> [!TIP]
> Используйте `make local-run-with-data` для максимальной производительности 

> [!TIP]
> или `make docker-run-with-hub-image` если нужен докер.

## Использование

Приложение состоит из двух вкладок с интерактивным интерфейсом.

### Боковая панель
- **Фильтры**: Страны, города, сезоны, даты (списки, слайдер, поля ввода).
- **Функциональность**: Поддержка дат с 1750 года, уточнение диапазона.
- **Индикация**: Количество выбранных дней.

> [!IMPORTANT]
> Выбор слишком большого диапазона может замедлить работу приложения, в связи с этим стоит ограничение на максимальное количество записей (30 000). Рекомендуется использовать фильтры для уточнения конкретных городов и временных периодов.

### Основной дашборд
- **Карточки метрик**:
  - Средняя температура.
  - Медиана температуры.
  - Доля дней с осадками.
  - Средняя скорость ветра.
- **Визуализации**:
  - Линейный график с настраиваемыми осями.
  - Диаграмма рассеяния с выбором метрик и окраской.
  - Гистограмма с регулируемым числом столбцов и отображаемой метрикой.
- **Таблица**: Настраиваемые столбцы.
- **Экспорт**: Скачивание данных в `.xlsx`.

### Дополнительные метрики
- **Карточки метрик**:
  - Диапазон средней температуры.
  - Разница экстремальных температур.
  - Средний уровень осадков.
  - Дни с дождём и снегом.
  - Направление ветра.
  - Максимальный порыв ветра.
  - Корреляция температуры и осадков.
- **Сезонная статистика**: Таблица с агрегациями (среднее, медиана, минимум, максимум) на русском языке.
- **Карта**: Географическая визуализация метрик по городам во всём мире в определённый день.
- **Экспорт**: Скачивание статистики в `.xlsx`.

> [!NOTE]
> Переключение на новую дату или выбор другой метрики может занять какое-то время, т.к. подгружаются данные со всего мира.

## Соответствие ТЗ

- **UI**: Боковая панель, карточки, графики, таблицы, кнопки экспорта.
- **Анализ данных**: Метрики (средние, медианы, корреляции, агрегации).
- **Интерактивность**: Динамическое обновление при изменении фильтров.
- **Структура проекта**: `app.py`, `requirements.txt`, данные, документация.
- **Документация**: README с инструкциями.

## Контакты
- **Telegram**: [@niki_zav](https://t.me/niki_zav)
- **Email**: [nikitazavyalov.cgartist@gmail.com](mailto:nikitazavyalov.cgartist@gmail.com)